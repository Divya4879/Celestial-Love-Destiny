const API_KEY = "AIzaSyDurAzClUGCNk2Dfxk7-YFGhvwQjZXrmp8";
const STORY_TEMPLATES = [
  `{girl}, a celestial navigator with eyes like shimmering nebulae and a laugh that echoed like the song of a binary star system, traced the constellations with a fingertip of stardust. A deep yearning, a cosmic loneliness, pulsed within her heart, a void waiting to be filled by a love as vast as the universe itself.

Across the galactic expanse, {boy}, a cosmic wanderer with a smile as bright as a supernova and hair like wisps of dark matter, drifted through the void, his heart a restless comet searching for its gravitational anchor. He felt an unseen force, a whisper of destiny, pulling him towards an unknown, yet irresistible, destination.

Their first encounter was a collision of fate, a celestial dance orchestrated by the universe itself. At the Grand Galactic Ball, held in the heart of a swirling nebula, amidst the glittering gas clouds and the music of colliding asteroids, their eyes met across the cosmic ballroom. Time seemed to warp and fold, the swirling dancers fading into the background as their universes narrowed to just each other.

{boy}, drawn to her like a moth to a celestial flame, approached {girl}, his voice a melodic whisper of solar winds, “I’ve traversed galaxies, searching for a love that shines brighter than any quasar. I believe, my beautiful {girl}, I’ve found it in you.”

{girl}’s heart, a lonely pulsar, skipped a beat. “I, too, have felt this cosmic pull, this inexplicable yearning,” she confessed, her voice a soft murmur of cosmic radiation, “a gravitational force drawing me to you, {boy}.”

But their love was a celestial tapestry woven with threads of both destiny and defiance. The ancient Star Council, guardians of cosmic balance, decreed their union forbidden. {girl}, a being of pure light, and {boy}, a creature of chaotic energy, were deemed too volatile a mix, a supernova waiting to explode and disrupt the delicate harmony of the cosmos. They were star-crossed lovers, their destinies tragically misaligned.

Tears, shimmering like frozen asteroids, welled in {girl}’s eyes. “Our love is a comet,” she cried, “a fleeting blaze of glory against the infinite darkness, but destined to be extinguished too soon.”

{boy} held her close, his touch igniting a celestial fire within her. “The universe cannot dictate the rhythm of our hearts,” he declared, his voice resonating with the power of a thousand exploding stars, “We will forge our own destiny, write our own love story across the canvas of the cosmos.”

They embarked on a perilous journey, a cosmic odyssey, fleeing the Star Council’s relentless pursuit. They hid in the swirling embrace of nebulae, danced through asteroid fields, and whispered sweet nothings under the watchful gaze of binary stars. With each stolen moment, their love burned brighter, a defiant supernova against the backdrop of an indifferent universe.

One starlit night, seeking refuge in a forgotten corner of the galaxy, they stumbled upon a hidden sanctuary, an ancient temple built from crystallized starlight. Within its shimmering walls, they discovered a forgotten prophecy, etched onto a tablet of pure cosmic energy: "Two souls, light and chaos intertwined, shall defy the cosmic order, their love the catalyst for a new era of universal harmony."

Armed with this prophecy, {girl} and {boy} returned to the Star Council. Standing before the ancient beings, {boy}, his eyes blazing with the fire of a thousand suns, declared, “Our love is not a threat, but a gift. It is the key to unlocking a new era of cosmic balance, a symphony of light and chaos harmonizing in perfect unison.”

{girl}, radiating a celestial glow, added, “We are not defying destiny, but fulfilling it. Our love is the missing piece, the final note in the cosmic symphony.”

The Star Council, moved by their unwavering love and the undeniable truth of the prophecy, rescinded their decree. The universe rejoiced, showering them with blessings of stardust and celestial light.

{girl} and {boy}, their love finally free to bloom, were joined in a cosmic ceremony beneath a canopy of swirling galaxies. Their union became a legend, a testament to the power of love to transcend even the most rigid cosmic laws, a beacon of hope shining brightly in the vast expanse of the universe. They ruled their own constellation, a swirling vortex of love and light, forever bound by a love as infinite and eternal as the cosmos itself.`,



  `{girl}, her laughter a cascade of shooting stars, mapped the unexplored constellations, her fingers tracing stardust across holographic charts. A celestial cartographer with eyes like swirling nebulae, she carried within her a cosmic loneliness, a yearning for a love as vast as the universe itself.

Across the galactic void, {boy}, a rogue astrophysicist with a smile as radiant as a supernova, surfed solar flares and whispered sonnets to dying stars. His heart, a restless red giant, pulsed with an unknown longing, a gravitational pull towards a destiny he couldn’t comprehend.

Their paths, woven by cosmic threads of fate, collided during the annual Celestial Convergence, a gathering of the galaxy's brightest minds and spirits. {girl}, adorned in a gown woven from moonbeams, stood bathed in the ethereal glow of a nearby quasar. {boy}, drawn to her like a comet to a sun, crossed the crowded ballroom, his heart pounding like a meteor shower.

“Across galaxies,” he murmured, his voice a whisper of solar wind, “I’ve searched for a love that shines brighter than any star. {girl}, my celestial navigator, I believe I’ve found it in you.”

{girl}’s breath caught in her throat, a nebula of emotions swirling within her. “I, too, have felt this cosmic tug, this inexplicable yearning,” she replied, her voice the gentle hum of cosmic radiation. “A gravitational force drawing me to you, {boy}.”

But their love was a celestial anomaly, a cosmic disruption. The Celestial Elders, guardians of universal balance, deemed their union forbidden. {girl}, a being of pure light, and {boy}, a creature of untamed energy, were star-crossed lovers, their love a threat to the delicate harmony of the cosmos.

Tears, like frozen asteroids, glimmered in {girl}'s eyes. “Our love is a supernova,” she whispered, “a brilliant burst of light destined to fade too soon.”

{boy}, his eyes blazing with the fire of a thousand suns, held her close. “The universe cannot contain the force of our love,” he declared, his voice a resonant echo through the galactic void. “We will rewrite our destiny, carve our own constellation in the fabric of space and time.”

They fled, embarking on a perilous journey through the cosmos, pursued by the Celestial Elders’ relentless sentinels. They hid in the swirling embrace of nebulae, danced through asteroid fields, their love a defiant comet streaking across the indifferent expanse.

One star-dusted night, seeking refuge in a hidden galaxy, they stumbled upon an ancient oracle, a being of pure cosmic energy. The oracle revealed a forgotten prophecy, etched in the heart of a dying star: “Two souls, light and energy intertwined, shall defy cosmic law, their love the catalyst for a new era of universal harmony.”

Armed with this prophecy, {girl} and {boy} returned, confronting the Celestial Elders. {boy}, his voice ringing with the power of a collapsing star, declared, “Our love is not a threat, but a gift. It is the key to unlocking a new era of cosmic balance.”

{girl}, radiating a celestial glow, added, “We are not defying destiny, but fulfilling it. Our love is the missing piece, the final note in the cosmic symphony.”

The Celestial Elders, moved by their unwavering love and the undeniable truth of the prophecy, rescinded their decree. The universe rejoiced, a symphony of celestial light and cosmic energy celebrating their union.

{girl} and {boy}, their love now a beacon of hope across the galaxy, were joined in a cosmic ceremony
 beneath a canopy of swirling stars. They ruled their own nebula, a swirling vortex of love and light, 
 their love a testament to the power of destiny and defiance, a love as infinite and eternal as the universe itself
 . And as they danced among the stars, their laughter echoed through the cosmos, a melody of love that would 
 resonate for eons to come.`,

  `{girl} a cosmic artist who painted nebulae with stardust and laughter, felt a pull, a cosmic yearning, a void in her soul shaped like a missing star. Her canvas, the infinite expanse of the universe, felt incomplete.

Across the galactic tapestry, {boy}, a rogue star-sailor with a smile as bright as a supernova and eyes that held the mysteries of black holes, navigated the celestial currents. He, too, felt the tug of destiny, an invisible string pulling him towards an unknown, yet irresistible, force.

Their destinies intertwined at the Celestial Solstice, a grand cosmic ballet of swirling galaxies and shimmering stardust. {girl}, adorned in a gown woven from the remnants of a dying star, caught {boy}’s eye across the cosmic ballroom. Time fractured, the music of colliding quasars fading as their universes narrowed to just each other.

He approached her, a comet streaking across the celestial dance floor, his trajectory guided by a billion years of cosmic longing. “Across nebulae and superclusters,” he whispered, his voice a symphony of solar winds, “I have searched for a love as radiant as you, {girl}. I believe my search has ended.”

{girl}'s heart, a lonely pulsar, skipped a beat. "And I," she replied, her voice a soft murmur of cosmic radiation, "have felt this inexplicable pull, this gravitational force drawing me to you, {boy}."

But their love story was written in the heart of a collapsing star, a tragic tale of forbidden affection. The Cosmic Council, keepers of universal balance, declared their union a cosmic anomaly. {girl}, a being of pure light, and {boy}, a creature of chaotic energy, were star-crossed lovers, their love deemed a threat to the delicate order of the cosmos.

Tears, like frozen asteroids, trailed down {girl}’s cheeks. “Our love is a fleeting comet,” she lamented, “a brilliant flash against the eternal night, destined to burn out too soon.”

{boy}, his eyes burning with the intensity of a thousand suns, held her close. “The universe cannot dictate the rhythm of our hearts,” he vowed, his voice echoing through the galactic silence. “We will chart our own course, create our own constellation of love.”

They embarked on a perilous journey, a cosmic odyssey across the universe, evading the Council’s relentless pursuit. They hid in the hearts of nebulae, danced among asteroid fields, their love a defiant supernova against the indifferent void.

One starlit night, seeking refuge in a forgotten corner of the galaxy, they stumbled upon a hidden sanctuary, the Temple of Cosmic Whispers. Within its shimmering walls, an ancient prophecy glowed, etched in pure starlight: “Two souls, light and chaos intertwined, shall defy cosmic decree, their love the key to a new era of universal harmony.”

Armed with this prophecy, they returned, confronting the Cosmic Council. {boy}, his voice resonating with the power of a collapsing star, declared, "Our love is not a threat, but a gift, a force that will bring balance to the cosmos."

{girl}, radiating a celestial luminescence, added, “We are not defying destiny, but fulfilling it. Our love is the missing piece, the final harmony in the cosmic symphony.”

The Council, moved by the unwavering strength of their love and the undeniable truth of the prophecy, rescinded their decree. The universe celebrated, showering them with stardust and celestial light.

{girl} and {boy}, their love a beacon of hope across the galaxy, were united in a cosmic ceremony, their vows echoing through the nebulae. They ruled their own constellation, a swirling vortex of love and light, their love a testament to the power of destiny and defiance. And as they danced among the stars, their laughter, like the music of the spheres, filled the cosmos, a love story whispered across the universe for eons to come.`,

  `{girl}, a celestial dreamer with eyes that mirrored distant galaxies and a laugh like the chime of colliding asteroids, charted the unknown corners of the cosmos. A cartographer of the heavens, she felt a profound loneliness, a cosmic void in her heart yearning for a love as boundless as the universe itself.

Across the star-dusted expanse, {boy}, a cosmic wanderer with a smile as warm as a supernova and hair like wisps of dark nebulae, sailed the solar winds, his heart a restless comet searching for its celestial anchor. He, too, felt an unseen pull, a whisper of destiny guiding him towards an unknown, yet irresistible, future.

Their paths, intertwined by the cosmic threads of fate, converged at the Galactic Gala, a dazzling spectacle of swirling nebulae and shimmering stardust. {girl}, radiant in a gown spun from moonbeams and meteor showers, caught {boy}’s eye across the celestial ballroom. Time seemed to warp and fold, the music of pulsars fading as their universes narrowed to just each other.

He drifted towards her, a celestial body drawn by her gravitational pull, his voice a soft murmur of solar winds. “Across galaxies and beyond," he whispered, "I've searched for a love as luminous as you, {girl}. My journey, I believe, has reached its destination.”

{girl}’s heart, a lonely pulsar, quickened its beat. “I, too,” she confessed, her voice a gentle echo of cosmic radiation, "have felt this inexplicable yearning, this cosmic magnetism drawing me to you, {boy}.”

But their love was a celestial paradox, a cosmic anomaly. The ancient Star Weavers, guardians of universal equilibrium, decreed their union forbidden. {girl}, a being of pure starlight, and {boy}, a creature of chaotic cosmic energy, were star-crossed lovers, their love perceived as a threat to the delicate balance of the cosmos.

Tears, like frozen stardust, shimmered in {girl}'s eyes. “Our love is a fleeting meteor,” she whispered, “a brilliant spark against the infinite darkness, destined to fade too quickly.”

{boy}, his eyes blazing with the intensity of a thousand suns, held her close. “The universe cannot contain the boundless power of our love,” he declared, his voice echoing through the celestial silence. “We will forge our own destiny, write our love story across the very fabric of space and time.”

They embarked on a perilous odyssey, fleeing across the cosmos, pursued by the Star Weavers' relentless sentinels. They hid amongst swirling nebulae, danced through asteroid fields, their love a defiant comet blazing across the indifferent void.

Seeking refuge in a forgotten galaxy, they stumbled upon the Celestial Oracle, a being of pure cosmic wisdom. The Oracle revealed an ancient prophecy, etched in the heart of a dying star: "Two souls, light and chaos entwined, shall defy cosmic law, their love the catalyst for a new era of universal harmony."

Armed with this prophecy, they returned, confronting the Star Weavers. {boy}, his voice resonating with the power of a collapsing supernova, declared, "Our love is not a disruption, but a gift, a force that will bring balance, not chaos, to the cosmos."

{girl}, radiating a celestial glow, added, “We are not defying destiny, but fulfilling it. Our love is the missing harmony, the final note in the cosmic symphony."

The Star Weavers, moved by the unwavering strength of their love and the undeniable truth of the prophecy, revoked their decree. The universe rejoiced, showering them with celestial blessings of stardust and nebulae.

{girl} and {boy}, their love now a beacon of hope across the galaxy, were united in a cosmic ceremony, their vows echoing through the star clusters. They ruled their own constellation, a swirling vortex of love and light, a sanctuary of cosmic harmony. Their love story, etched in the fabric of the universe, became a timeless ballad whispered across the cosmos for all eternity.`,

  `{girl}, a celestial sculptor who molded nebulae into breathtaking works of art, felt a cosmic loneliness, a void in her heart shaped like a missing star. Her laughter, like the chime of distant quasars, echoed through the empty halls of her asteroid studio.

Across the galactic canvas, {boy}, a rogue comet-racer with a smile as radiant as a supernova and eyes that held the secrets of black holes, navigated the celestial currents. His heart, a restless red giant, pulsed with an unknown yearning, drawn by an invisible thread of destiny.

Their paths, woven by stardust and cosmic fate, collided during the annual Celestial Convergence, a grand spectacle of swirling galaxies and shimmering constellations. {girl}, draped in a gown woven from the remnants of a dying star, caught {boy}’s eye across the cosmic ballroom. Time seemed to fracture, the music of colliding pulsars fading as their universes narrowed to just each other.

He approached her, a celestial body drawn by her gravitational pull, his voice a soft whisper of solar winds. “Across the vast expanse of the cosmos,” he murmured, his words like stardust kisses, "I've searched for a love as luminous as you, {girl}. My search, I believe, has ended."

{girl}'s heart, a lonely pulsar, skipped a cosmic beat. "And I," she replied, her voice the gentle hum of cosmic radiation, "have felt this inexplicable pull, this magnetic force drawing me to you, {boy}."

But their love was a celestial anomaly, a cosmic disruption. The Guardians of Harmony, ancient beings of pure energy, decreed their union forbidden. {girl}, a being of pure starlight, and {boy}, a creature of untamed cosmic energy, were star-crossed lovers, their love deemed a threat to the delicate balance of the universe.

Tears, like frozen asteroids, glistened in {girl}’s eyes. “Our love is a fleeting meteor,” she whispered, her voice laced with cosmic sorrow, "a brilliant flash against the eternal night, destined to burn out too soon."

{boy}, his eyes blazing with the fiery passion of a thousand suns, held her close. "The universe cannot contain the boundless energy of our love," he vowed, his voice resonating through the celestial silence. "We will forge our own destiny, paint our own constellation on the canvas of the cosmos.”

They embarked on a perilous journey, a cosmic odyssey across the universe, evading the Guardians’ relentless pursuit. They hid within the swirling embrace of nebulae, danced among asteroid fields, their love a defiant supernova against the indifferent void.

Seeking refuge in a forgotten corner of the galaxy, they discovered the Whispering Nebula, a place of ancient cosmic wisdom. Within its iridescent folds, a prophecy shimmered, etched in pure starlight: "Two souls, light and chaos intertwined, shall defy cosmic decree, their love the key to a new era of universal harmony."

Armed with this prophecy, they returned, confronting the Guardians of Harmony. {boy}, his voice resonating with the power of a collapsing star, declared, “Our love is not a threat, but a gift, a force that will usher in a new era of cosmic balance."

{girl}, radiating a celestial luminescence, added, “We are not defying destiny, but fulfilling it. Our love is the missing harmony, the final chord in the cosmic symphony.”

The Guardians, moved by the unwavering strength of their love and the undeniable truth of the prophecy, rescinded their decree. The universe rejoiced, showering them with cascades of stardust and celestial light.

{girl} and {boy}, their love a beacon of hope and harmony across the galaxy, were united in a cosmic ceremony, their vows echoing through the nebulae. They ruled their own constellation, a swirling vortex of love and light, their love a testament to the power of destiny and defiance, a love story whispered across the universe for eons to come, a cosmic masterpiece painted on the canvas of eternity.`,
];

// Cosmic Background Animation
const canvas = document.getElementById("cosmicCanvas");
const ctx = canvas.getContext("2d");
let stars = [];

function getZodiacSign(birthdate) {
  const date = new Date(birthdate);
  const [month, day] = [date.getMonth() + 1, date.getDate()];

  if ((month === 1 && day >= 20) || (month === 2 && day <= 18))
    return "Aquarius";
  if ((month === 2 && day >= 19) || (month === 3 && day <= 20)) return "Pisces";
  if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) return "Aries";
  if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) return "Taurus";
  if ((month === 5 && day >= 21) || (month === 6 && day <= 20)) return "Gemini";
  if ((month === 6 && day >= 21) || (month === 7 && day <= 22)) return "Cancer";
  if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) return "Leo";
  if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) return "Virgo";
  if ((month === 9 && day >= 23) || (month === 10 && day <= 22)) return "Libra";
  if ((month === 10 && day >= 23) || (month === 11 && day <= 21))
    return "Scorpio";
  if ((month === 11 && day >= 22) || (month === 12 && day <= 21))
    return "Sagittarius";
  return "Capricorn";
}

// Zodiac Compatibility Matrix
const compatibilityMatrix = {
  Aries: { best: ["Leo", "Sagittarius"], worst: ["Cancer", "Capricorn"] },
  Taurus: { best: ["Virgo", "Capricorn"], worst: ["Leo", "Aquarius"] },
  Gemini: { best: ["Libra", "Aquarius"], worst: ["Virgo", "Pisces"] },
  Cancer: { best: ["Scorpio", "Pisces"], worst: ["Aries", "Libra"] },
  Leo: { best: ["Aries", "Sagittarius"], worst: ["Taurus", "Scorpio"] },
  Virgo: { best: ["Taurus", "Capricorn"], worst: ["Gemini", "Sagittarius"] },
  Libra: { best: ["Gemini", "Aquarius"], worst: ["Cancer", "Capricorn"] },
  Scorpio: { best: ["Cancer", "Pisces"], worst: ["Leo", "Aquarius"] },
  Sagittarius: { best: ["Aries", "Leo"], worst: ["Virgo", "Pisces"] },
  Capricorn: { best: ["Taurus", "Virgo"], worst: ["Aries", "Libra"] },
  Aquarius: { best: ["Gemini", "Libra"], worst: ["Taurus", "Scorpio"] },
  Pisces: { best: ["Cancer", "Scorpio"], worst: ["Gemini", "Sagittarius"] },
};

function calculateCompatibility(sign1, sign2) {
  if (compatibilityMatrix[sign1].best.includes(sign2)) {
    return 80 + Math.floor(Math.random() * 20);
  }
  if (compatibilityMatrix[sign1].worst.includes(sign2)) {
    return 20 + Math.floor(Math.random() * 30);
  }
  return 50 + Math.floor(Math.random() * 30);
}

class Star {
  constructor() {
    this.reset();
    this.size = Math.random() * 3;
    this.speed = Math.random() * 0.5 + 0.2;
  }

  reset() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
  }

  update() {
    this.y += this.speed;
    if (this.y > canvas.height) this.reset();
  }

  draw() {
    ctx.fillStyle = `hsla(${Math.random() * 360}, 70%, 70%, 0.8)`;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fill();
  }
}

function initGalaxy() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  stars = Array.from({ length: 200 }, () => new Star());
}

function animate() {
  ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  stars.forEach((star) => {
    star.update();
    star.draw();
  });

  requestAnimationFrame(animate);
}

// Gender Detection
async function detectGender(name) {
  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          contents: [
            {
              parts: [
                {
                  text: `Is ${name} typically male or female? Answer only 'male' or 'female'`,
                },
              ],
            },
          ],
        }),
      }
    );
    const data = await response.json();
    return data.candidates[0].content.parts[0].text.toLowerCase();
  } catch {
    return "male";
  }
}

// Form Handling
document.getElementById("loveForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const name1 = document.getElementById("name1").value;
  const name2 = document.getElementById("name2").value;

  // Detect genders
  const gender1 = await detectGender(name1);
  const gender2 = await detectGender(name2);

  // Determine names
  let boyName = gender1 === "male" ? name1 : name2;
  let girlName = gender1 === "female" ? name1 : name2;

  const sign1 = getZodiacSign(document.getElementById("dob1").value);
  const sign2 = getZodiacSign(document.getElementById("dob2").value);
  const compatibility = calculateCompatibility(sign1, sign2);

  // Select random story template
  const randomStory = STORY_TEMPLATES[
    Math.floor(Math.random() * STORY_TEMPLATES.length)
  ]
    .replace(/{boy}/g, boyName)
    .replace(/{girl}/g, girlName);

  // Update UI
  document.getElementById("loveStory").innerHTML = randomStory;

  document.getElementById("loveStory").className = "story-box";
  createZodiacAnimation(compatibility);
  createShareButton(boyName, girlName, compatibility);
});

//  createZodiacAnimation function
function createZodiacAnimation(score) {
  const container = document.getElementById("zodiacAnimation");
  const hue = ((score + 10) / 130) * 360;

  container.innerHTML = `
                <div class="compatibility-heart" style="background: hsl(${hue}, 70%, 50%)">
                    <div class="heart-content">
                        <h2 style="margin: 0; font-size: 2.5rem">${score}%</h2>
                        <p style="margin: 0; color: var(--text-light)">Cosmic Harmony</p>
                    </div>
                </div>
            `;
}


// (form submission handler, gender detection, etc.)

function createShareButton(name1, name2, score) {
  const tweetText = `🌟 ${name1} & ${name2}'s Cosmic Love Score: ${score}%! ✨ Discover your cosmic destiny at ${window.location.href}`;
  document.getElementById("shareSection").innerHTML = `
                <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(
                  tweetText
                )}" 
                   class="twitter-share" 
                   target="_blank">
                    <i class="fa fa-twitter" style="font-size:36px; color:white"></i>
                </a>
            `;
}

// Initialize
window.addEventListener("resize", initGalaxy);
initGalaxy();
animate();
